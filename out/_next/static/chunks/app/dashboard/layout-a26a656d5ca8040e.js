(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{6947:function(e,t,r){Promise.resolve().then(r.bind(r,8453))},8453:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var s=r(7437),n=r(2265),o=r(4033),a=r(1349),i=r(9581);function c(e){let{children:t,fallbackPath:r="/login"}=e,{isAuthenticated:c,isLoading:l,validateAuth:u}=(0,a.a)(),f=(0,o.useRouter)();return((0,n.useEffect)(()=>{l||c||(console.warn("\uD83D\uDD12 User not authenticated, redirecting to login..."),f.replace(r))},[c,l,f,r]),(0,n.useEffect)(()=>{let e;let t=async()=>{let e=await u();e||f.replace(r)};return c&&(e=setInterval(t,3e5)),()=>{e&&clearInterval(e)}},[c,u,f,r]),l)?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-950 via-slate-950 to-purple-950 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)(i.Z,{size:64}),(0,s.jsx)("p",{className:"text-slate-400 text-lg",children:"Verifying authentication..."})]})}):c?(0,s.jsx)(s.Fragment,{children:t}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-950 via-slate-950 to-purple-950 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)(i.Z,{size:64}),(0,s.jsx)("p",{className:"text-slate-400 text-lg",children:"Redirecting to login..."})]})})}function l(e){let{children:t}=e;return(0,s.jsx)(c,{children:t})}},9581:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var s=r(7437);function n(e){let{size:t=48}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{width:t,height:t,viewBox:"0 0 48 48",fill:"none",className:"animate-spin",children:[(0,s.jsx)("circle",{cx:"24",cy:"24",r:"20",stroke:"url(#brand-gradient)",strokeWidth:"6",strokeLinecap:"round",strokeDasharray:"90 60"}),(0,s.jsx)("defs",{children:(0,s.jsxs)("linearGradient",{id:"brand-gradient",x1:"0",y1:"0",x2:"48",y2:"48",gradientUnits:"userSpaceOnUse",children:[(0,s.jsx)("stop",{stopColor:"#34d399"})," ",(0,s.jsx)("stop",{offset:"1",stopColor:"#22d3ee"})," "]})})]}),(0,s.jsx)("span",{className:"ml-3 text-emerald-400 font-bold text-lg"})]})}r(2265)},1349:function(e,t,r){"use strict";r.d(t,{a:function(){return o}});var s=r(2265),n=r(4033);function o(){let[e,t]=(0,s.useState)({isAuthenticated:!1,user:null,isLoading:!0}),[r,o]=(0,s.useState)(0),a=(0,n.useRouter)(),i=e=>{try{let t=e.split(".")[1],r=t.replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(r).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),n=JSON.parse(s),o=Date.now()/1e3;return n.exp<o}catch(e){return console.error("Error decoding token:",e),!0}},c=async()=>{let e=localStorage.getItem("accessToken"),t=localStorage.getItem("refreshToken"),r=localStorage.getItem("user");if(!e||!r)return!1;if(i(e)){if(console.warn("\uD83D\uDD04 Access token expired, attempting refresh..."),!t||i(t))return console.error("❌ Refresh token also expired or missing"),l(),!1;try{let e=await fetch("https://fogeapi-backend.onrender.com/api/user/refreshTokenApi",{method:"GET",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!e.ok)return console.error("❌ Token refresh failed"),l(),!1;{let t=await e.json();localStorage.setItem("accessToken",t.accessToken),localStorage.setItem("refreshToken",t.refreshToken),console.log("✅ Token refreshed successfully")}}catch(e){return console.error("❌ Error refreshing token:",e),l(),!1}}return!0},l=(0,s.useCallback)(()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),t({isAuthenticated:!1,user:null,isLoading:!1}),o(e=>e+1)},[]),u=(0,s.useCallback)((e,r,s)=>{console.log("\uD83D\uDD04 Setting auth data:",{user:s}),localStorage.setItem("accessToken",e),localStorage.setItem("refreshToken",r),localStorage.setItem("user",JSON.stringify(s)),t({isAuthenticated:!0,user:{...s},isLoading:!1}),o(e=>e+1),console.log("✅ Auth state updated successfully")},[]),f=(0,s.useCallback)(()=>{l(),a.push("/login")},[l,a]);return(0,s.useEffect)(()=>{let e=async()=>{t(e=>({...e,isLoading:!0}));let e=await c();if(e){let e=localStorage.getItem("user");e?t({isAuthenticated:!0,user:JSON.parse(e),isLoading:!1}):l()}else l()};e()},[]),{...e,setAuth:u,logout:f,validateAuth:c,clearAuth:l,updateTrigger:r}}},622:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=r(2265),n=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var s,o={},l=null,u=null;for(s in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,s)&&!c.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===o[s]&&(o[s]=t[s]);return{$$typeof:n,type:e,key:l,ref:u,props:o,_owner:i.current}}t.Fragment=o,t.jsx=l,t.jsxs=l},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(290)}},function(e){e.O(0,[971,864,744],function(){return e(e.s=6947)}),_N_E=e.O()}]);